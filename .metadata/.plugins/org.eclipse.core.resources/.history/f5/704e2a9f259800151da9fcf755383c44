package cbr;

import javax.annotation.Generated;

import jcolibri.cbraplications.StandardCBRApplication;
import jcolibri.cbrcore.Attribute;
import jcolibri.cbrcore.CBRCase;
import jcolibri.cbrcore.CBRCaseBase;
import jcolibri.cbrcore.CBRQuery;
import jcolibri.exception.ExecutionException;
import jcolibri.exception.InitializingException;
import jcolibri.method.retrieve.NNretrieval.NNConfig;
import representation.DescricaoDoCaso;

public class CBRApplication implements StandardCBRApplication {

	



	//******************************************************************/
	// Configuration
	//******************************************************************/

	@Override
	public void configure() throws ExecutionException {
		try{
			configureConnector();
			configureCaseBase();
		} catch (Exception e){
			throw new ExecutionException(e);
		}
	}

	/** Configures the connector */
	@Generated(value = { "CS-PTConector" })	
	private void configureConnector() throws InitializingException{
		connector = new jcolibri.connector.PlainTextConnector();
		connector.initFromXMLfile(jcolibri.util.FileIO
				.findFile("config/plainTextConnectorConfig.xml"));
	}

	/** Configures the case base */
	@Generated(value = { "CS-CaseManager" })	
	private void configureCaseBase() throws InitializingException{
		casebase = new jcolibri.casebase.LinearCaseBase();
	}

	//******************************************************************/
	// Similarity
	//******************************************************************/
	
	/** Configures the similarity */
	@Generated(value = { "CS-Similarity" })	
	private NNConfig getSimilarityConfig() {
		NNConfig simConfig = new NNConfig();
		simConfig
				.setDescriptionSimFunction(new jcolibri.method.retrieve.NNretrieval.similarity.global.Average());
		Attribute attribute0 = new Attribute("bloqueio", DescricaoDoCaso.class);
		simConfig
				.addMapping(
						attribute0,
						new jcolibri.method.retrieve.NNretrieval.similarity.local.Threshold());
		simConfig.setWeight(attribute0, 1.00);
		Attribute attribute1 = new Attribute("devolucao", DescricaoDoCaso.class);
		simConfig
				.addMapping(
						attribute1,
						new jcolibri.method.retrieve.NNretrieval.similarity.local.Threshold());
		simConfig.setWeight(attribute1, 1.00);
		Attribute attribute2 = new Attribute("preempcao", DescricaoDoCaso.class);
		simConfig
				.addMapping(
						attribute2,
						new jcolibri.method.retrieve.NNretrieval.similarity.local.Threshold());
		simConfig.setWeight(attribute2, 1.00);
		Attribute attribute3 = new Attribute("BAMAtual", DescricaoDoCaso.class);
		simConfig
				.addMapping(
						attribute3,
						new jcolibri.method.retrieve.NNretrieval.similarity.local.Equal());
		simConfig.setWeight(attribute3, 1.00);
		return simConfig;
	}

	//******************************************************************/
	// Methods
	//******************************************************************/
	


	@Generated(value = { "ColibriStudio" })
	public void postCycle() throws ExecutionException {
		jcolibri.method.postcycle.StoreCases.storeCases(connector, casebase);
	}

	@Generated(value = { "ColibriStudio" })
	public void cycle(jcolibri.cbrcore.CBRQuery query)
			throws ExecutionException {
		query = jcolibri.method.gui.formFilling.ObtainQueryWithFormMethod
				.obtainQueryWithoutInitialValues(query, null,
						null);
		/*filteredCases = jcolibri.method.retrieve.FilterBasedRetrieval.FilterBasedRetrievalMethod
				.filterCases(casebase.getCases(), query, filterConfig);
		userChoice = jcolibri.util.gui.DisplayCasesTableMethod
				.displayCasesInTableBasic(filteredCases);*/
		
	

	}

	@Generated(value = { "ColibriStudio" })
	public jcolibri.cbrcore.CBRCaseBase preCycle() throws ExecutionException {
		casebase = jcolibri.method.precycle.LoadCases.loadCases(connector,
				casebase);
		return casebase;
	}

	@Generated(value = { "ColibriStudio" })
	java.util.Collection<jcolibri.cbrcore.Attribute> hiddenAttributes;

	@Generated(value = { "ColibriStudio" })
	java.util.Map<jcolibri.cbrcore.Attribute, java.lang.String> labels;

	@Generated(value = { "ColibriStudio" })
	jcolibri.method.retrieve.FilterBasedRetrieval.FilterConfig filterConfig;

	@Generated(value = { "ColibriStudio" })
	jcolibri.cbrcore.Connector connector;

	@Generated(value = { "ColibriStudio" })
	jcolibri.cbrcore.CBRCaseBase casebase;

	@Generated(value = { "ColibriStudio" })
	java.util.Collection<jcolibri.cbrcore.CBRCase> filteredCases;

	@Generated(value = { "ColibriStudio" })
	jcolibri.util.gui.UserChoice userChoice;



	@Generated(value = { "ColibriStudio" })
	public void setLabels(
			java.util.Map<jcolibri.cbrcore.Attribute, java.lang.String> labels) {
		this.labels = labels;
	}

	@Generated(value = { "ColibriStudio" })
	public void setHiddenAttributes(
			java.util.Collection<jcolibri.cbrcore.Attribute> hiddenAttributes) {
		this.hiddenAttributes = hiddenAttributes;
	}

	@Generated(value = { "ColibriStudio" })
	public void setFilterConfig(
			jcolibri.method.retrieve.FilterBasedRetrieval.FilterConfig filterConfig) {
		this.filterConfig = filterConfig;
	}

	@Generated(value={"ColibriStudio"}) public static void main(String[] args){
		CBRApplication cbrApp=new CBRApplication();
		try {
			
			cbrApp.configure();
		
		CBRCaseBase caseBase=cbrApp.preCycle();
		jcolibri.cbrcore.CBRQuery query=new CBRQuery();
		query.setDescription(new DescricaoDoCaso());
		cbrApp.cycle(query);
		
		for (CBRCase c:caseBase.getCases())System.out.println(c);
				
		
		} catch (ExecutionException e){e.printStackTrace();}}
}
